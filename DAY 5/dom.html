<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<title>DOM Practice - Notes</title>
<style>
:root{
--bg:#f8f9fa;--text:#212529;--card:white;--border:#dee2e6;
--primary:#0d6efd;--danger:#dc3545;--success:#198754;
}
[data-theme="dark"]{
--bg:#212529;--text:#e9ecef;--card:#343a40;--border:#495057;
--primary:#6ea8fe;--danger:#ff6b6b;--success:#51cf66;
}
body{font-family:system-ui;background:var(--bg);color:var(--text);padding:20px;min-height:100vh;}
.container{max-width:700px;margin:auto;}
header{text-align:center;margin-bottom:20px;}
#theme-toggle{padding:8px 16px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;}
form{display:flex;gap:10px;margin-bottom:15px;}
#note-input{flex:1;padding:12px;font-size:1.1rem;border:1px solid var(--border);border-radius:6px;background:var(--card);color:var(--text);}
#add-btn{padding:12px 20px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;}
#search{width:100%;padding:10px;margin-bottom:15px;border:1px solid var(--border);border-radius:6px;background:var(--card);}
#notes-list{list-style:none;display:grid;gap:12px;padding:0;}
.note{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:16px;display:flex;flex-direction:column;gap:10px;cursor:grab;}
.note.completed .text{text-decoration:line-through;opacity:0.6;}
.note.dragging{opacity:0.4;transform:scale(0.98);}
.actions{display:flex;gap:10px;justify-content:flex-end;}
.btn{padding:6px 12px;border:none;border-radius:4px;cursor:pointer;}
.btn-complete{background:var(--success);color:white;}
.btn-delete{background:var(--danger);color:white;}
.color-picker{width:32px;height:32px;border:none;cursor:pointer;}
#modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
.modal-box{background:var(--card);padding:24px;border-radius:12px;width:90%;max-width:400px;text-align:center;}
.modal-buttons{margin-top:20px;display:flex;gap:12px;justify-content:center;}
</style>
</head>
<body>

<div class="container">
<header>
<h1>Notes Manager</h1>
<button id="theme-toggle">Dark Mode</button>
</header>

<form id="note-form">
<input id="note-input" placeholder="Type your note..." required>
<button id="add-btn">Add</button>
</form>

<input id="search" placeholder="Search notes...">
<ul id="notes-list"></ul>

<button id="clear-completed" style="margin-top:20px;background:var(--danger);color:white;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;">
Clear Completed
</button>
</div>

<div id="modal">
<div class="modal-box">
<h2>Clear all completed notes?</h2>
<div class="modal-buttons">
<button id="modal-no" class="btn" style="background:#6c757d;color:white;">No</button>
<button id="modal-yes" class="btn" style="background:var(--danger);color:white;">Yes</button>
</div>
</div>
</div>

<script>
const form=document.getElementById("note-form");
const input=document.getElementById("note-input");
const list=document.getElementById("notes-list");
const search=document.getElementById("search");
const themeToggle=document.getElementById("theme-toggle");
const modal=document.getElementById("modal");
const clearCompleted=document.getElementById("clear-completed");
const modalYes=document.getElementById("modal-yes");
const modalNo=document.getElementById("modal-no");

function createNote(text){
const li=document.createElement("li");
li.className="note";
li.draggable=true;

li.innerHTML=`
<div class="text">${text}</div>
<div class="actions">
<button class="btn btn-complete">Complete</button>
<button class="btn btn-delete">Delete</button>
<input type="color" class="color-picker">
</div>
`;
list.append(li);
}

form.addEventListener("submit",e=>{
e.preventDefault();
if(input.value.trim()==="")return;
createNote(input.value.trim());
input.value="";
});

list.addEventListener("click",e=>{
const note=e.target.closest(".note");
if(!note)return;

if(e.target.matches(".btn-delete")){
note.remove();
}

if(e.target.matches(".btn-complete")){
note.classList.toggle("completed");
}
});

list.addEventListener("change",e=>{
if(e.target.matches(".color-picker")){
e.target.closest(".note").style.backgroundColor=e.target.value;
}
});

list.addEventListener("dblclick",e=>{
if(e.target.classList.contains("text")){
const oldText=e.target.textContent;
const inp=document.createElement("input");
inp.value=oldText;
inp.className="edit";
e.target.replaceWith(inp);
inp.focus();

inp.addEventListener("keydown",ev=>{
if(ev.key==="Enter"){
const div=document.createElement("div");
div.className="text";
div.textContent=inp.value;
inp.replaceWith(div);
}
});
}
});

search.addEventListener("input",()=>{
const term=search.value.toLowerCase();
document.querySelectorAll(".note").forEach(n=>{
const txt=n.querySelector(".text").textContent.toLowerCase();
n.style.display=txt.includes(term)?"":"none";
});
});

themeToggle.addEventListener("click",()=>{
const html=document.documentElement;
html.dataset.theme=html.dataset.theme==="light"?"dark":"light";
themeToggle.textContent=html.dataset.theme==="light"?"Dark Mode":"Light Mode";
});

clearCompleted.addEventListener("click",()=>{
modal.style.display="flex";
});

modalNo.addEventListener("click",()=>{
modal.style.display="none";
});

modal.addEventListener("click",e=>{
if(e.target===modal)modal.style.display="none";
});

modalYes.addEventListener("click",()=>{
document.querySelectorAll(".note.completed").forEach(n=>n.remove());
modal.style.display="none";
});

let dragged=null;

list.addEventListener("dragstart",e=>{
if(e.target.classList.contains("note")){
dragged=e.target;
e.target.classList.add("dragging");
}
});

list.addEventListener("dragend",e=>{
if(e.target.classList.contains("note")){
e.target.classList.remove("dragging");
}
});

list.addEventListener("dragover",e=>{
e.preventDefault();
const after=getDragAfterElement(list,e.clientY);
if(after==null){
list.appendChild(dragged);
}else{
list.insertBefore(dragged,after);
}
});

function getDragAfterElement(container,y){
const els=[...container.querySelectorAll(".note:not(.dragging)")];
return els.reduce((closest,child)=>{
const box=child.getBoundingClientRect();
const offset=y-box.top-box.height/2;
if(offset<0 && offset>closest.offset){
return{offset:offset,element:child};
}else{
return closest;
}
},{offset:Number.NEGATIVE_INFINITY}).element;
}
</script>

</body>
</html>
